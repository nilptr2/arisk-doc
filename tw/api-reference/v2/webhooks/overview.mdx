---
title: "概覽與安全驗證"
description: "了解 Arisk V2 Webhook 的基本原理以及如何驗證推送消息的安全性。"
---

Arisk V2 通過 Webhook 向您配置的服務器發送實時 HTTP POST 請求，通知監控地址的風險等級變動或風險交易。

## 安全性驗證

為確保消息來源的真實性和完整性，Arisk 發送的每個 Webhook 請求都包含數字簽名。我們強烈建議您在處理請求前進行驗證。

### HTTP 請求頭

每個 Webhook 請求都會包含以下關鍵 Header：

| Header | 說明 | 示例 |
| :--- | :--- | :--- |
| **X-Arisk-Signature** | RSA-PSS 數字簽名（Base64 編碼） | `aGVsbG8gd29ybGQ=...` |
| **Authorization** | Bearer Token（僅在配置了 `auth_key` 時存在） | `Bearer your-secret-token` |

### 驗證步驟

1.  **驗證簽名（必須）**
    *   **算法**: RSA-PSS with SHA-256
    *   **簽名內容**: 請求 Body 的原始 JSON 字符串
    *   **公鑰**: 使用下方的 Arisk RSA 公鑰驗證 `X-Arisk-Signature` 中的簽名。

<CodeGroup>
```text 公鑰 (PEM)
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAy4SlJTdScP1YAtUqJ1Kz
vB7isAMYd5oeAUqtraQ2UeLTz8EnPAVgob88NwxnXENd/GWkzas18bjkEbZuPcYA
P+6cG5l077/zO8WCgUe+NheJUMYdLinvNovXB4oaPZ9EOSUPARyhupH+E5+Kr2Te
nn+q0wsq62ge6oo705FpJSePbtAQLUnpQYe9GDty50nuXTZ3dZgIMpFkgPI49viY
R0R72kC0l28BH/Ea9WxibKQuVngVMoK7/kLHNV93AEX5Rk1tUX+W/iKurhwxN1ei
1N9rBj0d6fupntF8RgDL7vhMa6JtZEnhscTvGZH8bPa2LXMsXVxTdeSZL9+ElFxK
awIDAQAB
-----END PUBLIC KEY-----
```
</CodeGroup>

2.  **驗證 Authorization（可選）**
    如果您在 Webhook 配置中設置了 `auth_key`，Arisk 會在 Header 中添加：
    `Authorization: Bearer <您的 auth_key>`

---

## 最佳實踐

- **快速響應（必選）**
  您的服務器在接收到 Webhook 請求後，應立即返回 HTTP 200 OK 狀態碼。
  - **返回數據**：響應體（Body）可以是空內容，也可以是一個簡單的 JSON（例如 `{"message": "received"}`）。我們的服務僅校驗 HTTP 狀態碼，不會解析響應體內容。
  - **超時風險**：請務必避免在同步請求中執行耗時操作，否則可能觸發發送端的超時重試機制（默認超時通常較短）。

- **異步處理（推薦）**
  建議採用**「先確認，後處理」**的策略。即在校驗簽名通過並接收數據後，立即返回 HTTP 200 響應，隨後將耗時的業務邏輯（如寫庫、級聯通知等）放入後台隊列異步處理，以確保接口的高可用性。

- **冪等性保障（關鍵）**
  受網絡波動或重試機制影響，您可能會收到重複的 Webhook 通知。請務必在業務層利用 Payload 中的 `alert.id` 字段作為唯一鍵進行冪等檢查。
